#!/bin/bash

echo "========================================"
echo "WiFi Penetration Testing Server"
echo "========================================"
echo ""
echo "WARNING: For authorized security testing only!"
echo "Only use on networks you own or have written authorization to test."
echo ""
echo "Press Ctrl+C to cancel, or Enter to continue..."
read

cd "$(dirname "$0")/../backend/wifi_pentesting"

echo ""
echo "Setting environment variables..."
export WIFI_PENTEST_ACKNOWLEDGED=1
export WIFI_INTERFACE=${WIFI_INTERFACE:-wlan0}
export WIFI_MONITOR_INTERFACE=${WIFI_MONITOR_INTERFACE:-wlan0mon}
export WORDLIST_DIR=${WORDLIST_DIR:-/usr/share/wordlists}
export HANDSHAKE_DIR=${HANDSHAKE_DIR:-/tmp/handshakes}

echo ""
echo "Checking dependencies..."
command -v aircrack-ng >/dev/null 2>&1 || {
    echo "WARNING: aircrack-ng not found. Install with:"
    echo "  sudo apt-get install aircrack-ng"
}

command -v hashcat >/dev/null 2>&1 || {
    echo "INFO: hashcat not found (optional). Install with:"
    echo "  sudo apt-get install hashcat"
}

command -v reaver >/dev/null 2>&1 || {
    echo "INFO: reaver not found (optional). Install with:"
    echo "  sudo apt-get install reaver"
}

echo ""
echo "Installing Python dependencies..."
pip install -r requirements.txt

echo ""
echo "========================================"
echo "Starting WiFi Penetration Testing API"
echo "========================================"
echo ""
echo "Server will start on http://localhost:5001"
echo "API endpoints:"
echo "  - GET  /api/pentesting/health"
echo "  - POST /api/pentesting/scan"
echo "  - POST /api/pentesting/wps-attack"
echo "  - POST /api/pentesting/capture-handshake"
echo "  - POST /api/pentesting/crack-password"
echo "  - POST /api/pentesting/full-attack"
echo ""
echo "Press Ctrl+C to stop the server"
echo ""

# Check if running with sudo for monitor mode operations
if [ "$EUID" -ne 0 ]; then
    echo "WARNING: Not running as root. Some features (monitor mode, packet injection) may not work."
    echo "Consider running with: sudo ./start_pentesting_server.sh"
    echo ""
fi

python3 pentesting_api.py
